<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sdel ‚Ä¢ Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background:#000; color:white; margin:0; overflow-x:hidden; }
    .stars { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
    .star { position:absolute; background:white; border-radius:50%; animation:fall linear infinite; }
    @keyframes fall { to { transform:translateY(100vh); } }
    .card { background:rgba(20,20,20,0.9); backdrop-filter:blur(10px); border:1px solid #333; }
    .glow { box-shadow:0 0 30px rgba(255,59,0,0.4); }
  </style>
</head>
<body>

  <div class="stars" id="stars"></div>

  <!-- Header -->
  <div class="border-b border-orange-900/50 bg-black/80 backdrop-blur sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-8 py-6 flex justify-between items-center">
      <div class="flex items-center gap-6">
        <button id="hamburger" class="text-4xl hover:text-orange-500 transition">‚ò∞</button>
        <h1 class="text-4xl font-black tracking-tighter"><span class="text-orange-500">ADMIN</span></h1>
      </div>
      <div class="flex items-center gap-6">
        <!-- Notification Bell -->
        <button onclick="openNotifications()" class="text-4xl hover:text-orange-500 transition relative">
          üîî
          <span id="notification-badge" class="absolute top-0 right-0 w-5 h-5 bg-red-600 rounded-full text-xs flex items-center justify-center font-bold hidden">3</span>
        </button>
        <!-- Logout -->
        <button onclick="window.location='login.html'" class="text-4xl hover:text-red-500 transition" title="Logout">
          ‚èª
        </button>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed inset-y-0 left-0 w-80 bg-black/95 backdrop-blur border-r border-orange-900/50 transform -translate-x-full transition-transform duration-300 z-40 pt-32">
    <nav class="px-6 space-y-3">
      <a href="admin-files.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">Uploaded Files</a>
    </nav>
  </aside>
  <div id="overlay" class="fixed inset-0 bg-black/70 z-30 hidden" onclick="closeMenu()"></div>

  <!-- Notification Panel -->
  <div id="notification-panel" class="fixed top-24 right-8 w-96 bg-black/95 backdrop-blur border border-orange-900/50 rounded-3xl p-6 transform translate-x-full transition-transform duration-300 z-40 max-h-[600px] overflow-y-auto hidden">
    <h3 class="text-2xl font-black mb-6">Notifications</h3>
    <div class="space-y-4" id="notifications-list">
      <!-- Notifications load here -->
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-8 py-12 space-y-12">

    <!-- Live Stats -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
      <div class="card rounded-3xl p-10 text-center glow">
        <p class="text-gray-400 text-lg mb-2">Total Users</p>
        <p class="text-6xl font-black text-orange-500 mt-4" id="total-users">‚Äî</p>
      </div>
      <div class="card rounded-3xl p-10 text-center glow">
        <p class="text-gray-400 text-lg mb-2">Active Runners</p>
        <p class="text-6xl font-black text-green-400 mt-4" id="total-runners">‚Äî</p>
      </div>
      <div class="card rounded-3xl p-10 text-center glow">
        <p class="text-gray-400 text-lg mb-2">Total Orders</p>
        <p class="text-6xl font-black text-blue-400 mt-4" id="total-orders">‚Äî</p>
      </div>
      <div class="card rounded-3xl p-10 text-center glow">
        <p class="text-gray-400 text-lg mb-2">Site Status</p>
        <div class="mt-4 flex justify-center items-center">
          <div id="site-status-indicator" class="w-20 h-20 rounded-full flex items-center justify-center">
            <div id="site-status-dot" class="w-12 h-12 rounded-full animate-pulse"></div>
          </div>
        </div>
        <p id="site-status-text" class="text-xl font-bold mt-2"></p>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="card rounded-3xl p-12">
      <h2 class="text-4xl font-black mb-10 text-center">Quick Actions</h2>
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-4">
        <button onclick="showCreateRunner()" class="p-8 bg-gradient-to-br from-green-600 to-green-800 hover:from-green-500 hover:to-green-700 rounded-2xl font-bold text-xl transition transform hover:scale-105">
          ‚ûï Create Runner
        </button>
        <button onclick="showBroadcast()" class="p-8 bg-gradient-to-br from-blue-600 to-blue-800 hover:from-blue-500 hover:to-blue-700 rounded-2xl font-bold text-xl transition transform hover:scale-105">
          üì¢ Broadcast Message
        </button>
        <button onclick="window.location='admin-files.html'" class="p-8 bg-gradient-to-br from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 rounded-2xl font-bold text-xl transition transform hover:scale-105">
          üìÅ Review Files
        </button>
        <button onclick="toggleMaintenance()" class="p-8 bg-gradient-to-br from-orange-600 to-orange-800 hover:from-orange-500 hover:to-orange-700 rounded-2xl font-bold text-xl transition transform hover:scale-105" id="maintenance-btn">
          üîß Maintenance Mode
        </button>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="card rounded-3xl p-12">
      <h2 class="text-4xl font-black mb-10">Recent Activity</h2>
      <div class="space-y-4" id="activity-log">
        <!-- Activity items load here -->
      </div>
    </div>

    <!-- User & Runner Management -->
    <div class="grid md:grid-cols-2 gap-8">
      
      <!-- Users List -->
      <div class="card rounded-3xl p-10">
        <h3 class="text-3xl font-black mb-8">Recent Users</h3>
        <div class="space-y-4" id="users-list">
          <!-- Users load here -->
        </div>
      </div>

      <!-- Runners List -->
      <div class="card rounded-3xl p-10">
        <h3 class="text-3xl font-black mb-8">Active Runners</h3>
        <div class="space-y-4" id="runners-list">
          <!-- Runners load here -->
        </div>
      </div>
    </div>

    <!-- Pending Approvals -->
    <div class="card rounded-3xl p-12">
      <h2 class="text-4xl font-black mb-10">Pending Approvals</h2>
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3" id="pending-grid">
        <!-- Pending items load here -->
      </div>
    </div>

  </div>

  <!-- Modal for Create Runner -->
  <div id="create-runner-modal" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-8">
    <div class="card rounded-3xl p-12 max-w-2xl w-full">
      <h3 class="text-4xl font-black mb-8 text-center">Create Runner Account</h3>
      <div class="space-y-6">
        <input type="text" id="runner-name" placeholder="Full Name" class="w-full p-5 bg-gray-800 rounded-2xl border border-gray-700 text-lg">
        <input type="email" id="runner-email" placeholder="Email Address" class="w-full p-5 bg-gray-800 rounded-2xl border border-gray-700 text-lg">
        <input type="tel" id="runner-phone" placeholder="Phone Number" class="w-full p-5 bg-gray-800 rounded-2xl border border-gray-700 text-lg">
        <input type="password" id="runner-password" placeholder="Password" class="w-full p-5 bg-gray-800 rounded-2xl border border-gray-700 text-lg">
        <div class="flex gap-4">
          <button onclick="createRunner()" class="flex-1 py-5 bg-green-600 hover:bg-green-700 rounded-2xl font-bold text-xl">Create</button>
          <button onclick="closeModal()" class="flex-1 py-5 bg-gray-700 hover:bg-gray-600 rounded-2xl font-bold text-xl">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for Broadcast -->
  <div id="broadcast-modal" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-8">
    <div class="card rounded-3xl p-12 max-w-2xl w-full">
      <h3 class="text-4xl font-black mb-8 text-center">Broadcast Message</h3>
      <div class="space-y-6">
        <textarea id="broadcast-message" placeholder="Type your message..." class="w-full p-5 bg-gray-800 rounded-2xl border border-gray-700 text-lg h-48"></textarea>
        <div class="grid grid-cols-3 gap-4">
          <button onclick="sendBroadcast('all')" class="py-5 bg-blue-600 hover:bg-blue-700 rounded-2xl font-bold text-lg">All Users</button>
          <button onclick="sendBroadcast('runners')" class="py-5 bg-green-600 hover:bg-green-700 rounded-2xl font-bold text-lg">Runners Only</button>
          <button onclick="closeModal()" class="py-5 bg-gray-700 hover:bg-gray-600 rounded-2xl font-bold text-lg">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Hamburger menu
    document.getElementById('hamburger').onclick = () => {
      document.getElementById('sidebar').classList.toggle('-translate-x-full');
      document.getElementById('overlay').classList.toggle('hidden');
    };
    function closeMenu() {
      document.getElementById('sidebar').classList.add('-translate-x-full');
      document.getElementById('overlay').classList.add('hidden');
    }

    // Notification panel
    window.openNotifications = () => {
      const panel = document.getElementById('notification-panel');
      panel.classList.toggle('hidden');
      panel.classList.toggle('translate-x-full');
      loadNotifications();
    };

    async function loadNotifications() {
      // Sample notifications - replace with real data from your database
      const notifications = [
        { from: 'Super Admin', message: 'System maintenance scheduled for tonight', time: '2 min ago', read: false },
        { from: 'User #123', message: 'New file uploaded for review', time: '15 min ago', read: false },
        { from: 'Super Admin', message: 'Monthly report is ready', time: '1 hour ago', read: true },
        { from: 'User #456', message: 'Withdrawal request submitted', time: '2 hours ago', read: true },
      ];

      const unreadCount = notifications.filter(n => !n.read).length;
      const badge = document.getElementById('notification-badge');
      if (unreadCount > 0) {
        badge.textContent = unreadCount;
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }

      document.getElementById('notifications-list').innerHTML = notifications.length === 0
        ? '<p class="text-gray-500 text-center py-8">No notifications</p>'
        : notifications.map(n => `
          <div class="p-4 bg-black/60 rounded-xl border ${n.read ? 'border-gray-800' : 'border-orange-600'} hover:border-orange-500 transition">
            <div class="flex justify-between items-start mb-2">
              <p class="font-bold ${n.read ? 'text-gray-400' : 'text-white'}">${n.from}</p>
              <p class="text-xs text-gray-500">${n.time}</p>
            </div>
            <p class="text-sm ${n.read ? 'text-gray-500' : 'text-gray-300'}">${n.message}</p>
          </div>
        `).join('');
    }

    const supabase = window.supabase.createClient(
      'https://crasacrormxxombnaklt.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyYXNhY3Jvcm14eG9tYm5ha2x0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNjg1NTAsImV4cCI6MjA3OTg0NDU1MH0.q_apkDBu_QVwebbfjRqZ7QwrsNm9xQysRoNhayNyfLU'
    );

    async function load() {
      const [profiles, orders, pending, settings] = await Promise.all([
        supabase.from('profiles').select('*').order('created_at', { ascending: false }),
        supabase.from('orders').select('id', { count: 'exact' }),
        supabase.from('pending_runners').select('*'),
        supabase.from('site_settings').select('*').single()
      ]);

      // Stats
      document.getElementById('total-users').textContent = profiles.data?.length || 0;
      document.getElementById('total-runners').textContent = profiles.data?.filter(p => p.user_type === 'runner' && p.is_verified).length || 0;
      document.getElementById('total-orders').textContent = orders.count || 0;

      // Site Status - Visual indicator
      const live = !settings.data?.maintenance;
      const statusDot = document.getElementById('site-status-dot');
      const statusText = document.getElementById('site-status-text');
      
      if (live) {
        statusDot.className = 'w-12 h-12 rounded-full animate-pulse bg-green-500';
        statusText.textContent = 'LIVE';
        statusText.className = 'text-xl font-bold mt-2 text-green-500';
      } else {
        statusDot.className = 'w-12 h-12 rounded-full animate-pulse bg-red-500';
        statusText.textContent = 'MAINTENANCE';
        statusText.className = 'text-xl font-bold mt-2 text-red-500';
      }

      // Recent Users
      const recentUsers = profiles.data?.filter(p => p.user_type !== 'runner').slice(0, 5) || [];
      document.getElementById('users-list').innerHTML = recentUsers.length === 0 
        ? '<p class="text-gray-500 text-center py-8">No users found</p>'
        : recentUsers.map(u => `
          <div class="p-5 bg-black/60 rounded-xl border border-gray-800 hover:border-orange-500 transition flex justify-between items-center">
            <div>
              <p class="font-bold text-lg">${u.name || 'No Name'}</p>
              <p class="text-gray-400 text-sm">${u.email}</p>
            </div>
            <div class="flex gap-2">
              ${u.banned 
                ? `<button onclick="act('${u.id}','unban')" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm font-bold">Unban</button>`
                : `<button onclick="act('${u.id}','ban')" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-bold">Ban</button>`
              }
            </div>
          </div>
        `).join('');

      // Active Runners
      const activeRunners = profiles.data?.filter(p => p.user_type === 'runner' && p.is_verified).slice(0, 5) || [];
      document.getElementById('runners-list').innerHTML = activeRunners.length === 0
        ? '<p class="text-gray-500 text-center py-8">No runners found</p>'
        : activeRunners.map(r => `
          <div class="p-5 bg-black/60 rounded-xl border border-gray-800 hover:border-orange-500 transition flex justify-between items-center">
            <div>
              <p class="font-bold text-lg">${r.name || 'No Name'}</p>
              <p class="text-gray-400 text-sm">${r.email}</p>
            </div>
            <div class="flex gap-2">
              ${r.suspended 
                ? `<button onclick="act('${r.id}','unsuspend')" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-sm font-bold">Unsuspend</button>`
                : `<button onclick="act('${r.id}','suspend')" class="px-4 py-2 bg-orange-600 hover:bg-orange-700 rounded-lg text-sm font-bold">Suspend</button>`
              }
            </div>
          </div>
        `).join('');

      // Pending Approvals
      document.getElementById('pending-grid').innerHTML = pending.data?.length === 0
        ? '<p class="col-span-full text-gray-500 text-center py-12 text-xl">No pending approvals</p>'
        : pending.data?.map(p => `
          <div class="p-6 bg-black/60 rounded-2xl border border-yellow-600 hover:border-orange-500 transition">
            <p class="font-bold text-xl mb-2">${p.name}</p>
            <p class="text-gray-400 mb-4">${p.email}</p>
            <div class="flex gap-3">
              <button onclick="approvePending('${p.id}')" class="flex-1 py-3 bg-green-600 hover:bg-green-700 rounded-xl font-bold">Approve</button>
              <button onclick="rejectPending('${p.id}')" class="flex-1 py-3 bg-red-600 hover:bg-red-700 rounded-xl font-bold">Reject</button>
            </div>
          </div>
        `).join('');

      // Activity Log
      const activities = [
        { action: 'New user registered', user: recentUsers[0]?.name || 'Unknown', time: '2 min ago' },
        { action: 'Order completed', user: 'Runner #12', time: '15 min ago' },
        { action: 'Withdrawal approved', user: 'Runner #8', time: '1 hour ago' },
        { action: 'New file uploaded', user: recentUsers[1]?.name || 'Unknown', time: '2 hours ago' },
      ];
      
      document.getElementById('activity-log').innerHTML = activities.map(a => `
        <div class="p-5 bg-black/60 rounded-xl border border-gray-800 flex justify-between items-center">
          <div>
            <p class="font-bold">${a.action}</p>
            <p class="text-gray-400 text-sm">${a.user}</p>
          </div>
          <p class="text-gray-500 text-sm">${a.time}</p>
        </div>
      `).join('');

      // Load notifications on page load
      loadNotifications();
    }

    window.act = async (id, action) => {
      if (action==='ban') await supabase.from('profiles').update({banned:true,suspended:false}).eq('id',id);
      if (action==='unban') await supabase.from('profiles').update({banned:false,suspended:false}).eq('id',id);
      if (action==='suspend') await supabase.from('profiles').update({suspended:true}).eq('id',id);
      if (action==='unsuspend') await supabase.from('profiles').update({suspended:false}).eq('id',id);
      load();
    };

    window.showCreateRunner = () => {
      document.getElementById('create-runner-modal').classList.remove('hidden');
    };

    window.showBroadcast = () => {
      document.getElementById('broadcast-modal').classList.remove('hidden');
    };

    window.closeModal = () => {
      document.getElementById('create-runner-modal').classList.add('hidden');
      document.getElementById('broadcast-modal').classList.add('hidden');
    };

    window.createRunner = async () => {
      const name = document.getElementById('runner-name').value;
      const email = document.getElementById('runner-email').value;
      const phone = document.getElementById('runner-phone').value;
      const password = document.getElementById('runner-password').value;

      if (!name || !email || !phone || !password) {
        alert('Please fill all fields');
        return;
      }

      // Add your runner creation logic here
      alert('Runner account created successfully!');
      closeModal();
      load();
    };

    window.sendBroadcast = async (audience) => {
      const message = document.getElementById('broadcast-message').value;
      if (!message) {
        alert('Please enter a message');
        return;
      }

      // Add your broadcast logic here
      alert(`Message sent to ${audience}!`);
      closeModal();
    };

    window.toggleMaintenance = async () => {
      // Add your maintenance toggle logic here
      alert('Maintenance mode toggled!');
      load();
    };

    window.approvePending = async (id) => {
      // Add approval logic
      alert('Pending runner approved!');
      load();
    };

    window.rejectPending = async (id) => {
      // Add rejection logic
      alert('Pending runner rejected!');
      load();
    };

    // Stars
    for(let i=0; i<300; i++){
      const s = document.createElement('div');
      s.className = 'star';
      s.style.width = s.style.height = (Math.random()*3+1)+'px';
      s.style.left = Math.random()*100+'vw';
      s.style.animationDuration = (Math.random()*50+30)+'s';
      s.style.animationDelay = Math.random()*10+'s';
      document.getElementById('stars').appendChild(s);
    }

    load();
    setInterval(load, 10000);
  </script>
</body>
</html>
