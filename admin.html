<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sdel ‚Ä¢ Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
      body { font-family: 'Inter', sans-serif; background:#000; color:white; margin:0; overflow-x:hidden; }
      .stars { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
      .star { position:absolute; background:white; border-radius:50%; animation:fall linear infinite; }
      @keyframes fall { to { transform:translateY(100vh); } }
      .card { background:rgba(20,20,20,0.9); backdrop-filter:blur(10px); border:1px solid #333; }
      .glow { box-shadow:0 0 30px rgba(255,59,0,0.4); }
    </style>
</head>
<body>

  <div class="stars" id="stars"></div>

  <!-- Header -->
  <div class="border-b border-orange-900/50 bg-black/80 backdrop-blur sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-8 py-6 flex justify-between items-center">
      <div class="flex items-center gap-6">
        <button id="hamburger" class="text-4xl hover:text-orange-500 transition">‚ò∞</button>
        <h1 class="text-4xl font-black tracking-tighter"><span class="text-orange-500">ADMIN</span></h1>
      </div>
      <div class="flex items-center gap-6">
        <!-- Notification Bell -->
        <button id="notification-bell" class="text-4xl hover:text-orange-500 transition relative">
          üîî
          <span id="notification-badge" class="absolute top-0 right-0 w-5 h-5 bg-red-600 rounded-full text-xs flex items-center justify-center font-bold hidden">0</span>
        </button>
        <!-- Logout -->
        <button onclick="window.location='login.html'" class="text-4xl hover:text-red-500 transition" title="Logout">
          ‚èª
        </button>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed inset-y-0 left-0 w-80 bg-black/95 backdrop-blur border-r border-orange-900/50 transform -translate-x-full transition-transform duration-300 z-40 pt-32">
    <nav class="px-6 space-y-3">
      <a href="admin-files.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">Uploaded Files</a>
    </nav>
  </aside>
  <div id="overlay" class="fixed inset-0 bg-black/70 z-30 hidden" onclick="closeMenu()"></div>

  <!-- Notification Panel -->
  <div id="notification-panel" class="fixed top-24 right-8 w-96 bg-black/95 backdrop-blur border border-orange-900/50 rounded-3xl p-6 transform translate-x-full transition-transform duration-300 z-40 max-h-[600px] overflow-y-auto hidden">
    <h3 class="text-2xl font-black mb-6">Notifications</h3>
    <div class="space-y-4" id="notifications-list">
      <p class="text-gray-500 text-center py-8">Loading notifications...</p>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-8 py-12 space-y-12">

    <!-- Live Stats -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
      <div class="card rounded-3xl p-10 text-center glow">
        <p class="text-gray-400 text-lg mb-2">Total Users</p>
        <p class="text-6xl font-black text-orange-500 mt-4" id="total-users">‚Äî</p>
      </div>
      <div class="card rounded-3xl p-10 text-center glow">
        <p class="text-gray-400 text-lg mb-2">Active Runners</p>
        <p class="text-6xl font-black text-green-400 mt-4" id="total-runners">‚Äî</p>
      </div>
      <div class="card rounded-3xl p-10 text-center glow">
        <p class="text-gray-400 text-lg mb-2">Total Orders</p>
        <p class="text-6xl font-black text-blue-400 mt-4" id="total-orders">‚Äî</p>
      </div>
      <div class="card rounded-3xl p-10 text-center glow">
        <p class="text-gray-400 text-lg mb-2">Pending Uploads</p>
        <p class="text-6xl font-black text-purple-400 mt-4" id="pending-uploads">‚Äî</p>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="card rounded-3xl p-12">
      <h2 class="text-4xl font-black mb-10 text-center">Quick Actions</h2>
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-4">
        <button onclick="showCreateRunner()" class="p-8 bg-gradient-to-br from-green-600 to-green-800 hover:from-green-500 hover:to-green-700 rounded-2xl font-bold text-xl transition transform hover:scale-105">
          ‚ûï Create Runner
        </button>
        <button onclick="showBroadcast()" class="p-8 bg-gradient-to-br from-blue-600 to-blue-800 hover:from-blue-500 hover:to-blue-700 rounded-2xl font-bold text-xl transition transform hover:scale-105">
          üì¢ Broadcast Message
        </button>
        <button onclick="window.location='admin-files.html'" class="p-8 bg-gradient-to-br from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 rounded-2xl font-bold text-xl transition transform hover:scale-105">
          üìÅ Review Files
        </button>
      </div>
    </div>

    <!-- Recent Activity (placeholder) -->
    <div class="card rounded-3xl p-12">
      <h2 class="text-4xl font-black mb-10">Recent Activity</h2>
      <div class="space-y-4" id="activity-log">
        <p class="text-gray-500 text-center py-8">Activity log coming soon</p>
      </div>
    </div>

    <!-- User & Runner Management (placeholder) -->
    <div class="grid md:grid-cols-2 gap-8">
      <div class="card rounded-3xl p-10">
        <h3 class="text-3xl font-black mb-8">Recent Users</h3>
        <div class="space-y-4" id="users-list">
          <p class="text-gray-500 text-center py-8">Users list coming soon</p>
        </div>
      </div>

      <div class="card rounded-3xl p-10">
        <h3 class="text-3xl font-black mb-8">Active Runners</h3>
        <div class="space-y-4" id="runners-list">
          <p class="text-gray-500 text-center py-8">Runners list coming soon</p>
        </div>
      </div>
    </div>

    <!-- Pending Approvals -->
    <div class="card rounded-3xl p-12">
      <h2 class="text-4xl font-black mb-10">Pending Approvals</h2>
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3" id="pending-grid">
        <p class="col-span-full text-gray-500 text-center py-12 text-xl">Loading pending uploads...</p>
      </div>
    </div>

  </div>

  <!-- Modals remain the same (Create Runner, Broadcast) -->
  <!-- (Omitted for brevity - copy from your original file) -->

  <script>
    // Hamburger menu
    document.getElementById('hamburger').onclick = () => {
      document.getElementById('sidebar').classList.toggle('-translate-x-full');
      document.getElementById('overlay').classList.toggle('hidden');
    };
    function closeMenu() {
      document.getElementById('sidebar').classList.add('-translate-x-full');
      document.getElementById('overlay').classList.add('hidden');
    }

    // Notification bell click
    document.getElementById('notification-bell').onclick = () => {
      const panel = document.getElementById('notification-panel');
      panel.classList.toggle('hidden');
      panel.classList.toggle('translate-x-full');
      loadNotifications();
      clearNotificationCount();  // Clear badge when opened
    };

    const supabase = window.supabase.createClient(
      'https://lfjvnyeirxdvwxvzyocc.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxmanZueWVpcnhkdnd4dnp5b2NjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5NTI3MTUsImV4cCI6MjA4MDUyODcxNX0.JPekpIORM0jkTlfhjcCrwczf7wzkIT7csClSYJZyd5A'
    );

    let lastSeenNotificationTime = localStorage.getItem('lastSeenNotification') ? new Date(localStorage.getItem('lastSeenNotification')) : new Date(0);

    // Clear notification count and update last seen time
    function clearNotificationCount() {
      localStorage.setItem('lastSeenNotification', new Date().toISOString());
      const badge = document.getElementById('notification-badge');
      badge.classList.add('hidden');
      badge.textContent = '0';
    }

    // Load notifications from updates table (general + team)
    async function loadNotifications() {
      const { data: notifications, error } = await supabase
        .from('updates')
        .select('title, message, type, created_at')
        .order('created_at', { ascending: false })
        .limit(20);

      if (error || !notifications || notifications.length === 0) {
        document.getElementById('notifications-list').innerHTML = '<p class="text-gray-500 text-center py-8">No notifications</p>';
        return;
      }

      const unreadCount = notifications.filter(n => new Date(n.created_at) > lastSeenNotificationTime).length;

      const badge = document.getElementById('notification-badge');
      if (unreadCount > 0) {
        badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }

      document.getElementById('notifications-list').innerHTML = notifications.map(n => {
        const timeAgo = new Date(n.created_at).toLocaleString();
        const isUnread = new Date(n.created_at) > lastSeenNotificationTime;
        return `
          <div class="p-4 bg-black/60 rounded-xl border ${isUnread ? 'border-orange-600' : 'border-gray-800'} hover:border-orange-500 transition">
            <div class="flex justify-between items-start mb-2">
              <p class="font-bold \( {isUnread ? 'text-white' : 'text-gray-400'} capitalize"> \){n.type} Update</p>
              <p class="text-xs text-gray-500">${timeAgo}</p>
            </div>
            <p class="font-semibold \( {isUnread ? 'text-white' : 'text-gray-300'}"> \){n.title || 'Update'}</p>
            <p class="text-sm \( {isUnread ? 'text-gray-300' : 'text-gray-500'} mt-1"> \){n.message}</p>
          </div>
        `;
      }).join('');
    }

    // Real-time subscription for new updates
    function subscribeToNotifications() {
      supabase
        .channel('updates-notifications')
        .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'updates' }, () => {
          loadNotifications();
        })
        .subscribe();
    }

    async function load() {
      const { data: usersData } = await supabase.from('Users').select('id');
      document.getElementById('total-users').textContent = usersData ? usersData.length : 0;

      const { count: ordersCount } = await supabase.from('orders').select('*', { count: 'exact', head: true });
      document.getElementById('total-orders').textContent = ordersCount || 0;

      const { count: runnersCount } = await supabase.from('runners').select('*', { count: 'exact', head: true });
      document.getElementById('total-runners').textContent = runnersCount || 0;

      const { count: pendingCount } = await supabase.from('User_uploads').select('*', { count: 'exact', head: true }).eq('status', 'pending');
      document.getElementById('pending-uploads').textContent = pendingCount || 0;

      loadNotifications();
    }

    // Stars
    for(let i=0; i<300; i++){
      const s = document.createElement('div');
      s.className = 'star';
      s.style.width = s.style.height = (Math.random()*3+1)+'px';
      s.style.left = Math.random()*100+'vw';
      s.style.animationDuration = (Math.random()*50+30)+'s';
      s.style.animationDelay = Math.random()*10+'s';
      document.getElementById('stars').appendChild(s);
    }

    // Init
    load();
    subscribeToNotifications();
    setInterval(load, 15000); // Refresh stats every 15 seconds
  </script>
</body>
                                                                                    </html>
