<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Uploaded Files â€¢ Sdel Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background:#000; color:white; margin:0; overflow-x:hidden; }
    .stars { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
    .star { position:absolute; background:white; border-radius:50%; animation:fall linear infinite; }
    @keyframes fall { to { transform:translateY(100vh); } }
    .card { background:rgba(20,20,20,0.9); backdrop-filter:blur(10px); border:1px solid #333; }
    .glow { box-shadow:0 0 30px rgba(255,59,0,0.4); }
  </style>
</head>
<body>

  <div class="stars" id="stars"></div>

  <!-- Header -->
  <div class="border-b border-orange-900/50 bg-black/80 backdrop-blur sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-8 py-6 flex justify-between items-center">
      <div class="flex items-center gap-6">
        <button id="hamburger" class="text-4xl hover:text-orange-500 transition">â˜°</button>
        <img src="sdel-cheetah-logo.svg" class="w-16 h-16 glow">
        <h1 class="text-4xl font-black tracking-tighter">Sdel <span class="text-orange-500">ADMIN</span></h1>
      </div>
      <a href="admin-login.html" class="px-8 py-4 bg-red-600 hover:bg-red-700 rounded-xl font-bold text-lg">Exit</a>
    </div>
  </div>

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed inset-y-0 left-0 w-80 bg-black/95 backdrop-blur border-r border-orange-900/50 transform -translate-x-full transition-transform duration-300 z-40 pt-24">
    <nav class="px-6 space-y-3">
      <a href="admin-dashboard.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">Dashboard</a>
      <a href="admin-users.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">All Users</a>
      <a href="admin-runners.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">All Runners</a>
      <a href="admin-create-runner.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">Create Runner</a>
      <a href="admin-pending.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">Pending Runners</a>
      <a href="admin-files.html" class="block px-6 py-5 rounded-xl bg-orange-600 font-bold text-lg">Uploaded Files</a>
      <a href="admin-orders.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">Orders</a>
      <a href="admin-withdrawals.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">Withdrawals</a>
      <a href="admin-broadcast.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">Broadcast</a>
      <a href="admin-control.html" class="block px-6 py-5 rounded-xl hover:bg-gray-900 font-bold text-lg border border-gray-800">Site Control</a>
    </nav>
  </aside>
  <div id="overlay" class="fixed inset-0 bg-black/70 z-30 hidden" onclick="closeMenu()"></div>

  <div class="max-w-7xl mx-auto px-8 py-12">
    <h2 class="text-5xl font-black mb-12 text-center">Uploaded Files</h2>

    <!-- Filter Tabs -->
    <div class="flex justify-center gap-4 mb-12">
      <button onclick="filterFiles('all')" id="filter-all" class="px-8 py-4 bg-orange-600 rounded-xl font-bold text-lg">All Files</button>
      <button onclick="filterFiles('pending')" id="filter-pending" class="px-8 py-4 bg-gray-800 hover:bg-gray-700 rounded-xl font-bold text-lg">Pending</button>
      <button onclick="filterFiles('accepted')" id="filter-accepted" class="px-8 py-4 bg-gray-800 hover:bg-gray-700 rounded-xl font-bold text-lg">Accepted</button>
      <button onclick="filterFiles('rejected')" id="filter-rejected" class="px-8 py-4 bg-gray-800 hover:bg-gray-700 rounded-xl font-bold text-lg">Rejected</button>
    </div>

    <!-- Files Grid -->
    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3" id="files-grid">
      <!-- Files load here -->
    </div>
  </div>

  <script>
    // Hamburger menu
    document.getElementById('hamburger').onclick = () => {
      document.getElementById('sidebar').classList.toggle('-translate-x-full');
      document.getElementById('overlay').classList.toggle('hidden');
    };
    function closeMenu() {
      document.getElementById('sidebar').classList.add('-translate-x-full');
      document.getElementById('overlay').classList.add('hidden');
    }

    const supabase = window.supabase.createClient(
      'https://crasacrormxxombnaklt.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyYXNhY3Jvcm14eG9tYm5ha2x0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNjg1NTAsImV4cCI6MjA3OTg0NDU1MH0.q_apkDBu_QVwebbfjRqZ7QwrsNm9xQysRoNhayNyfLU'
    );

    let allFiles = [];
    let currentFilter = 'all';

    async function loadFiles() {
      // Adjust table name and columns based on your database structure
      const { data, error } = await supabase
        .from('uploaded_files') // Change this to your actual table name
        .select('*, profiles(name, email)')
        .order('created_at', { ascending: false });

      if (error) {
        console.error('Error loading files:', error);
        return;
      }

      allFiles = data || [];
      displayFiles();
    }

    function displayFiles() {
      const filtered = currentFilter === 'all' 
        ? allFiles 
        : allFiles.filter(f => f.status === currentFilter);

      document.getElementById('files-grid').innerHTML = filtered.length === 0
        ? '<p class="col-span-full text-center text-2xl text-gray-500 py-20">No files found</p>'
        : filtered.map(file => `
          <div class="card rounded-2xl p-8 hover:border-orange-500 transition">
            <div class="mb-6">
              ${file.file_type?.includes('image') 
                ? `<img src="${file.file_url}" class="w-full h-48 object-cover rounded-xl mb-4" />`
                : `<div class="w-full h-48 bg-gray-800 rounded-xl flex items-center justify-center text-6xl mb-4">ðŸ“„</div>`
              }
              <p class="text-xl font-bold">${file.file_name || 'Unnamed File'}</p>
              <p class="text-gray-400 mt-2">${file.profiles?.name || 'Unknown User'}</p>
              <p class="text-gray-500 text-sm">${file.profiles?.email || ''}</p>
              <p class="text-gray-600 text-xs mt-2">${new Date(file.created_at).toLocaleString()}</p>
            </div>
            
            <div class="flex items-center justify-between mb-4">
              <span class="px-4 py-2 rounded-full text-sm font-bold ${
                file.status === 'accepted' ? 'bg-green-900 text-green-300' :
                file.status === 'rejected' ? 'bg-red-900 text-red-300' :
                'bg-yellow-900 text-yellow-300'
              }">
                ${file.status?.toUpperCase() || 'PENDING'}
              </span>
            </div>

            ${file.status === 'pending' || !file.status ? `
              <div class="flex gap-3">
                <button onclick="handleFile('${file.id}', 'accepted')" class="flex-1 py-4 bg-green-600 hover:bg-green-700 rounded-xl font-bold">ACCEPT</button>
                <button onclick="handleFile('${file.id}', 'rejected')" class="flex-1 py-4 bg-red-600 hover:bg-red-700 rounded-xl font-bold">REJECT</button>
              </div>
            ` : `
              <div class="text-center py-4">
                <button onclick="viewFile('${file.file_url}')" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-bold">VIEW FILE</button>
              </div>
            `}
          </div>
        `).join('');
    }

    window.handleFile = async (id, status) => {
      const { error } = await supabase
        .from('uploaded_files')
        .update({ status })
        .eq('id', id);

      if (!error) {
        loadFiles();
      } else {
        alert('Error updating file status: ' + error.message);
      }
    };

    window.viewFile = (url) => {
      window.open(url, '_blank');
    };

    window.filterFiles = (filter) => {
      currentFilter = filter;
      
      // Update button styles
      ['all', 'pending', 'accepted', 'rejected'].forEach(f => {
        const btn = document.getElementById(`filter-${f}`);
        if (f === filter) {
          btn.className = 'px-8 py-4 bg-orange-600 rounded-xl font-bold text-lg';
        } else {
          btn.className = 'px-8 py-4 bg-gray-800 hover:bg-gray-700 rounded-xl font-bold text-lg';
        }
      });

      displayFiles();
    };

    // Stars
    for(let i=0; i<300; i++){
      const s = document.createElement('div');
      s.className = 'star';
      s.style.width = s.style.height = (Math.random()*3+1)+'px';
      s.style.left = Math.random()*100+'vw';
      s.style.animationDuration = (Math.random()*50+30)+'s';
      s.style.animationDelay = Math.random()*10+'s';
      document.getElementById('stars').appendChild(s);
    }

    loadFiles();
    setInterval(loadFiles, 10000);
  </script>
</body>
</html>
